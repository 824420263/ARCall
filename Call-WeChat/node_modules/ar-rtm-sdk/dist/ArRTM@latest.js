/*!
  * ar-rtm-sdk v1.0.11
  * (c) 2023 anyRTM SDK
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).self=e.self||{})}(this,(function(e){"use strict";var t={VERSION:"1.0.11",GATEWAY_ADDRESS:"https://rtmgw.agrtc.cn",GATEWAY_CONNECT_TIMEOUT:3e3,GATEWAY_CONNECT_INTERVAL_TIMES:2e3,GATEWAY_RETRY_TIMEOUT:12e5,LOGIN_TIMEOUT:12e3},n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{E(r.next(e))}catch(e){i(e)}}function a(e){try{E(r.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}E((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function E(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function _(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}var c,u=function(){function e(e){if(this._url="",this._wss=!0,this._port=443,this._timeout=6e4,"[object Object]"===Object.prototype.toString.call(e)){var t=e.url,n=e.wss,r=e.port,o=e.timeout;"string"==typeof t&&(this._url=t),"boolean"==typeof n&&(this._wss=n,this._port=n?443:80),"number"==typeof r&&(this._port=r),"number"==typeof o&&(this._timeout=o)}}return e.prototype.setRequestUrl=function(e){if("[object Object]"===Object.prototype.toString.call(e)){var t=e.url,n=e.wss,r=e.port;"string"==typeof t&&(this._url=t),"boolean"==typeof n&&(this._wss=n,this._port=n?443:80),"number"==typeof r&&(this._port=r)}},e.prototype.request=function(e,t,n){return this._sendUrlRequest(e,t,n)},e.prototype.post=function(e,t){return this.request(e,"POST",t)},e.prototype.get=function(e,t){return this.request(e,"GET",t)},e.prototype._sendUrlRequest=function(e,t,n,r){var o=this;return void 0===r&&(r=!0),new Promise((function(i,s){if(""!==o._url){var a=o._url;e&&(a=o._url+e);try{wx.getSystemInfo(),wx.request({url:a,timeout:o._timeout,method:t,header:{"content-type":"application/json"},data:n,complete:function(e){var t=e.statusCode;i(200===t?e.data:{code:-1,msg:e.errMsg})}})}catch(e){var E=new XMLHttpRequest,_=function(){200===E.status?i(JSON.parse(E.responseText)):s("NETWORK_RESPONSE_ERROR")};r&&(E.onreadystatechange=function(){4===E.readyState&&_()}),E.open(t,a,r),E.onerror=function(e){s("NETWORK_ERROR")},E.ontimeout=function(){s("NETWORK_TIMEOUT")},E.send(JSON.stringify(n)),r||_()}}else s("NO_REQUEST_URL")}))},e}(),R={generateLowCaseString:function(e){void 0===e&&(e=7);var t=Math.random().toString(16).substr(2,e).toLowerCase();return t.length===e?t:t+this.generateLowCaseString(e-t.length)},generateUpperCaseString:function(e){return this.generateLowCaseString(e||32).toUpperCase()},getByteLength:function(e){for(var t=0,n=0;n<e.length;n++)e.charCodeAt(n)>255?t+=2:t++;return t}},l=function(e,t){var n="YYYY-MM-DD hh:mm:ss";if("number"!=typeof e)throw new Error("[timesToDate]: timestamp must be number");t&&"string"==typeof t&&(n=t);var r=e||Date.now(),o=new Date(r)||new Date(r),i=o.getFullYear(),s=o.getMonth()+1,a=o.getDate(),E=o.getHours(),_=o.getMinutes(),c=o.getSeconds();return n.indexOf("YYYY")>-1&&(n=n.replace("YYYY",(function(){return""+i}))),n.indexOf("MM")>-1?n=n.replace("MM",(function(){return s<10?"0"+s:""+s})):n.indexOf("M")>-1&&(n=n.replace("M",(function(){return""+s}))),n.indexOf("DD")>-1?n=n.replace("DD",(function(){return a<10?"0"+a:""+a})):n.indexOf("D")>-1&&(n=n.replace("D",(function(){return""+a}))),n.indexOf("hh")>-1?n=n.replace("hh",(function(){return E<10?"0"+E:""+E})):n.indexOf("h")>-1&&(n=n.replace("h",(function(){return""+E}))),n.indexOf("mm")>-1?n=n.replace("mm",(function(){return _<10?"0"+_:""+_})):n.indexOf("m")>-1&&(n=n.replace("m",(function(){return""+_}))),n.indexOf("ss")>-1?n=n.replace("ss",(function(){return c<10?"0"+c:""+c})):n.indexOf("s")>-1&&(n=n.replace("s",(function(){return""+c}))),n},d=function(e){void 0===e&&(e=13),e>20&&(e=20);var t=Math.ceil(Math.random()*Math.pow(10,e));return t<Math.pow(10,e-1)?d(e):t},N=function(e,t){var n=this;this.onFinally=t,this.promise=new Promise((function(t,r){return i(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.resolve=t,this.reject=r,e?[4,e(t,r)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))})).finally((function(){var e;return null===(e=n.onFinally)||void 0===e?void 0:e.call(n)}))};!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.NONE=4]="NONE"}(c||(c={}));var I,T=function(){function e(){this.logPrefix="SupLogger",this.logLevel=c.NONE,this.uploadServeTranslators=[],this.DEBUG=c.DEBUG,this.INFO=c.INFO,this.WARNING=c.WARNING,this.ERROR=c.ERROR,this.NONE=c.NONE}return e.prototype.use=function(e){"function"==typeof e&&this.uploadServeTranslators.push((function(t,n){e(t,n)}))},e.prototype.setLogLevel=function(e,t){t&&(this.logPrefix=t),"number"==typeof e&&e>-1&&e<5&&(this.logLevel=e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!(this.logLevel>c.ERROR&&this.logLevel!==c.NONE||this.logLevel===c.NONE)){var n=e,r=Date.now();n.unshift("["+l(r,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [ERROR]:%c","color: #b00020; font-weight: bold;","color: #dc3545;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(e){e({type:"error",params:n,timestamp:r},(function(){console.error.apply(console,n)}))})):console.error.apply(console,n)}},e.prototype.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!(this.logLevel>c.WARNING&&this.logLevel!==c.NONE||this.logLevel===c.NONE)){var n=e,r=Date.now();n.unshift("["+l(r,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [WARNING]:","color: #ffc107; font-weight: bold;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(e){e({type:"warning",params:n,timestamp:r},(function(){console.warn.apply(console,n)}))})):console.warn.apply(console,n)}},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!(this.logLevel>c.INFO&&this.logLevel!==c.NONE||this.logLevel===c.NONE)){var n=e,r=Date.now();n.unshift("["+l(r,"hh:mm:ss:ms")+"] %c"+this.logPrefix+" [INFO]:","color:  #007bff; font-weight: bold;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(e){e({type:"info",params:n,timestamp:r},(function(){console.log.apply(console,n)}))})):console.log.apply(console,n)}},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!(this.logLevel>c.DEBUG&&this.logLevel!==c.NONE||this.logLevel===c.NONE)){var n=e,r=Date.now();n.unshift("["+l(r,"hh:mm:ss.ms")+"] %c"+this.logPrefix+" [DEBUG]:","color:#6facff;"),this.uploadServeTranslators.length>0?this.uploadServeTranslators.map((function(e){e({type:"debug",params:n,timestamp:r},(function(){console.log.apply(console,n)}))})):console.log.apply(console,n)}},e}(),O=new T;O.setLogLevel(O.DEBUG,"ar-rtm-sdk"),function(e){e.INVALID_PARAMS="INVALID_PARAMS",e.DEVELOPER_INVALID="DEVELOPER_INVALID",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.APPID_INVALID="APPID_INVALID",e.SERVER_NOT_OPEN="SERVER_NOT_OPEN",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.TOKEN_INVALID="TOKEN_INVALID",e.UNKNOWN="UNKNOWN",e.TIMEOUT="TIMEOUT"}(I||(I={}));var C=function(){function e(){this._urls=[],this._urlSuffix="/arapi/v1?action=",this._appid="",this._sessionId="",this.msgSuffix="/arapi/v1/artmgw/",this._urls=[t.GATEWAY_ADDRESS],this._urlSuffix="/arapi/v1?action="}return e.prototype.joinGateway=function(e,n){var r=this;void 0===e&&(e={});var a=this;return new Promise((function(E,_){var c=a._urlSuffix.concat("wrtm_gateway"),R=function(){return i(r,void 0,void 0,(function(){var r,i,l,d,N,T;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,Promise.race(this._urls.map((function(n){return new u({url:n,timeout:t.GATEWAY_CONNECT_TIMEOUT}).post(c,o({},e))})))];case 1:if(r=s.sent())if(0===(i=r.code))l=r.sessionid,d=e.appid,a._sessionId=l,a._appid=d,E(r);else{if(-1===i||1===i)throw new Error("NETWORK_TIMEOUT");_(-4===i||-7===i||3===i?I.INVALID_PARAMS:13===i?I.DEVELOPER_INVALID:14===i?I.UID_BANNED:15===i?I.IP_BANNED:16===i?I.CHANNEL_BANNED:101===i||4===i?I.APPID_INVALID:102===i?I.SERVER_NOT_OPEN:109===i||6===i?I.TOKEN_EXPIRED:110===i||5===i?I.TOKEN_INVALID:"Error Code "+i+".")}return[3,3];case 2:return N=s.sent(),"NETWORK_ERROR"===(T=N)||"NETWORK_TIMEOUT"===T||"NETWORK_RESPONSE_ERROR"===T?(O.warning("reconnect gateway server, reason: "+T),Date.now()>n+t.LOGIN_TIMEOUT?(_(I.TIMEOUT),[2]):(setTimeout((function(){R()}),t.GATEWAY_CONNECT_INTERVAL_TIMES),[2])):(O.debug("XMLHttpRequest abort error ",T),_(I.UNKNOWN),[3,3]);case 3:return[2]}}))}))};R()}))},e.prototype.getChanHistoryMsg=function(e){return i(this,void 0,void 0,(function(){var n,r=this;return s(this,(function(a){return n=this,[2,new Promise((function(a,E){return i(r,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return r=n.msgSuffix.concat("getChanHistoryMsg"),[4,new u({url:t.GATEWAY_ADDRESS,timeout:t.GATEWAY_CONNECT_TIMEOUT}).post(r,o(o({},e),{sessId:n._sessionId,appId:n._appid})).then((function(e){return e}))];case 1:return i=s.sent(),a(i),[2]}}))}))}))]}))}))},e.prototype.getOfflineMsg=function(e){return i(this,void 0,void 0,(function(){var n,r=this;return s(this,(function(a){return n=this,[2,new Promise((function(a,E){return i(r,void 0,void 0,(function(){var r,i;return s(this,(function(s){switch(s.label){case 0:return r=n.msgSuffix.concat("getOfflineMsg"),[4,new u({url:t.GATEWAY_ADDRESS,timeout:t.GATEWAY_CONNECT_TIMEOUT}).post(r,o(o({},e),{sessId:n._sessionId,appId:n._appid})).then((function(e){return e}))];case 1:return i=s.sent(),a(i),[2]}}))}))}))]}))}))},e.prototype.getP2PHistoryMsg=function(e){var n=this,r=this;return new Promise((function(a,E){return i(n,void 0,void 0,(function(){var n,i;return s(this,(function(s){switch(s.label){case 0:return n=r.msgSuffix.concat("getP2PHistoryMsg"),[4,new u({url:t.GATEWAY_ADDRESS,timeout:t.GATEWAY_CONNECT_TIMEOUT}).post(n,o(o({},e),{sessId:r._sessionId,appId:r._appid})).then((function(e){return e}))];case 1:return i=s.sent(),a(i),[2]}}))}))}))},e}(),v=function(){function e(e){if(this._websocket=null,this._url="",this._wss=!0,this._port=443,this._listenCallback=[],this.onclose=function(){},this.onerror=function(){},this.onmessage=function(){},e&&"[object Object]"===Object.prototype.toString.call(e)){var t=e.url,n=e.wss,r=e.port;t&&(this._url=t),"boolean"==typeof n&&(this._wss=n),r&&(this._port=r)}}return Object.defineProperty(e.prototype,"connectState",{get:function(){return this._websocket?this._websocket.readyState:WebSocket.CLOSED},enumerable:!1,configurable:!0}),e.prototype.open=function(e){var t=this;return new Promise((function(n,r){if(t._websocket&&O.error("ERROR: SignalingChannel has already opened."),e&&"[object Object]"===Object.prototype.toString.call(e)){var o=e.url,i=e.wss,s=e.port;o&&(t._url=o),"boolean"==typeof i&&(t._wss=i),s&&(t._port=s)}var a=(t._wss?"wss":"ws")+"://"+t._url+":"+t._port;O.debug("SignalingChannel start connect, url "+a+".");var E=function(){O.debug("Signaling channel opened."),t._websocket.onerror=function(e){O.debug("Signaling channel error."),t.onerror(e)},t._websocket.onclose=function(e){O.debug("Channel closed with code: "+e.code+" reason: "+e.reason),t._websocket=null,t.onclose(e)},n()},_=function(e){t._listenCallback.forEach((function(t){t(e)})),t.onmessage(e)},c=function(e){r(Error("WebSocket error."))};try{wx.getSystemInfo(),t._websocket=wx.connectSocket({url:a,complete:function(){}}),t._websocket.onOpen(E),t._websocket.onMessage(_),t._websocket.onError(c)}catch(e){try{t._websocket=new WebSocket(a),t._websocket.onopen=E,t._websocket.onmessage=_,t._websocket.onerror=c}catch(e){t._websocket=null}}}))},e.prototype.close=function(){this._websocket&&(this._websocket.close(),this._websocket=null)},e.prototype.send=function(e){if("object"!=typeof e)return O.error("signal channel msg must be object."),!1;if(this._websocket)try{return wx.getSystemInfo(),this._websocket.send({data:JSON.stringify(e)})}catch(t){1===this._websocket.readyState&&this._websocket.send(JSON.stringify(e))}},e.prototype.addMessageEventListener=function(e,t){this._websocket&&this._listenCallback.push(e)},e.prototype.removeMessageEventListener=function(e,t){if(this._websocket)for(var n=this._listenCallback.length-1;n>-1;n--)this._listenCallback[n]===e&&this._listenCallback.splice(n,1)},e.prototype.clear=function(){this.close(),this.onerror=function(){},this.onclose=function(){},this.onmessage=function(){},this.addMessageEventListener=function(){},this.removeMessageEventListener=function(){}},e}(),h=function(e){function t(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=e.apply(this,_([],E(n)))||this;o.name="RTMException",o.code=t;var i="Error Code "+t+" - ";return o.message=n[0]?i.concat(n[0]):i,o.data=n[1]?n[1]:{},o}return r(t,e),t}(Error),A=function(e){function t(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=e.apply(this,_([t],E(n)))||this;return o.name="RtmInvalidArgumentError",o}return r(t,e),t}(h);!function(e){function t(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=e.apply(this,_([t],E(n)))||this;return o.name="RtmUnauthenticatedError",o}r(t,e)}(h);var S=function(e){return e.then((function(e){return[null,e]})).catch((function(e){return[e]}))},p={},f=function(){return function(){var e,t,n=void 0,r=navigator.userAgent,o=r.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===o[1]&&null!=(n=r.match(/(OPR(?=\/))\/?(\d+)/i))&&(o=n),"Safari"===o[1]&&null!=(n=r.match(/version\/(\d+)/i))&&(o[2]=n[1]),~r.toLowerCase().indexOf("qqbrowser")&&null!=(n=r.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(o=n),~r.toLowerCase().indexOf("micromessenger")&&null!=(n=r.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(o=n),~r.toLowerCase().indexOf("edge")&&null!=(n=r.match(/(edge(?=\/))\/?(\d+)/i))&&(o=n),~r.toLowerCase().indexOf("trident")&&null!=(n=/\brv[ :]+(\d+)/g.exec(r)||[])&&(o=[null,"IE",n[1]]);var i=void 0;try{for(var s=a([{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}]),E=s.next();!E.done;E=s.next()){var _=E.value;if(_.r.test(navigator.userAgent)){i=_.s;break}}}catch(t){e={error:t}}finally{try{E&&!E.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return{name:o[1],version:o[2],os:i}}()},m=function(){return f().os};p.getBrowserInfo=f,p.getBrowserOS=m,p.isChrome=function(){var e=f();return e.name&&"Chrome"===e.name},p.isSafari=function(){var e=f();return e.name&&"Safari"===e.name},p.isEdge=function(){var e=f();return e.name&&"Edge"===e.name},p.isFireFox=function(){var e=f();return e.name&&"Firefox"===e.name},p.isOpera=function(){var e=f();return e.name&&"OPR"===e.name},p.isQQBrowser=function(){var e=f();return e.name&&"QQBrowser"===e.name},p.isWeChatBrowser=function(){var e=f();return e.name&&"MicroMessenger"===e.name},p.isSupportedPC=function(){var e=m();return"Linux"===e||"Mac OS X"===e||"Mac OS"===e||-1!==e.indexOf("Windows")},p.isSupportedMobile=function(){var e=m();return"Android"===e||"iOS"===e},p.getBrowserVersion=function(){return f().version},p.isChromeKernel=function(){return!!navigator.userAgent.match(/chrome\/[\d]./i)},p.isLegacyChrome=function(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35};var L=!1;try{wx.getSystemInfo()}catch(e){L=p.isChrome()&&p.getBrowserVersion()>=87}var g,y,U,M,b,w,D,G,P,B,F,V,J,W,k,Y,H,K,j,x,Q,X,z,$,Z,q,ee=function(t){function n(e){var n=t.call(this)||this;n._cmdEncrypt=!1,n._appId="",n._serverIsWss=!0,n._serverUrl="",n._serverPort=0,n._userId=null,n._connectTimeout=null,n._keepAliveTimeout=null,n._keepALiveInterval=null,n._keepALiveIntervalTime=1e4,n._sendMsgTimeOutInterval=1e4,n._revState="DISCONNECTED",n._curState="DISCONNECTED",n.handleMediaServerEvents=function(){};var r=n;return e&&e.appId&&(r._appId=e.appId),n}return r(n,t),n.prototype.init=function(e){var t=this,n=e.appId,r=e.isWss,o=e.url,i=e.port;t._appId=n,"boolean"==typeof r&&(t._serverIsWss=r),o&&(t._serverUrl=o),i&&(t._serverPort=i)},n.prototype.setAppInfo=function(e){var t=e.appId;this._appId=t},n.prototype.configServer=function(e,t,n){var r=this;r._serverIsWss=e,r._serverUrl=t,r._serverPort=n},n.prototype.connectServer=function(){var e=this,t=this;return new Promise((function(n,r){return i(e,void 0,void 0,(function(){var e,o,i,a=this;return s(this,(function(s){switch(s.label){case 0:return t._emitConnectionState("CONNECTING"),t._setConnectTimeout(),[4,S(t.open({url:t._serverUrl,wss:t._serverIsWss,port:t._serverPort}))];case 1:return e=E.apply(void 0,[s.sent(),2]),(o=e[0])?(t._clearConnectTimeout(),r(o)):(i=(t._serverIsWss?"wss":"ws")+"://"+t._serverUrl+":"+t._serverPort,O.debug("[ws-client] websocket opened: "+i),t._clearConnectTimeout(),t._emitConnectionState("CONNECTED"),t.onmessage=function(e){var n=e.data,r=JSON.parse(n),o=r.Cmd;r.Encrypt;var i=r.Content,s=JSON.parse(i);switch(o){case"KeepAlive":t._clearKeepALiveTimeout();break;case"ReqKeepAlive":a.doKeepAlive();break;case"Login":!L&&t._startKeepAlive();break;default:t.handleMediaServerEvents&&t.handleMediaServerEvents(o,s)}},t.onerror=function(e){O.error("WebSocket with some error ",e)},t.onclose=function(e){var n=e.code,r=e.reason;switch(O.info("serve disconnected...",n),t._clearConnectTimeout(),t._stopKeepAlive(),t._clearKeepALiveTimeout(),n){case 1e3:case 1005:t._emitConnectionState("DISCONNECTED","LEAVE");break;case 3001:t._emitConnectionState("RECONNECTING","NETWORK_ERROR");break;default:O.debug("media ws serve disconnected with code "+n+", reason "+r),"RECONNECTING"!==t._curState&&t._emitConnectionState("RECONNECTING","SERVER_ERROR")}t.clear()},n()),[2]}}))}))}))},n.prototype.doKeepAlive=function(){var e=this,t={Cmd:"KeepAlive"};t.Encrypt=this._cmdEncrypt,t.Content=JSON.stringify({time:Date.now().toString()}),this.send(t),!e._keepAliveTimeout&&(e._keepAliveTimeout=setTimeout((function(){e._stopKeepAlive(),e._clearKeepALiveTimeout(),e.clear(),e._emitConnectionState("RECONNECTING","KEEP_A_LIVE_TIME_OUT")}),2*e._keepALiveIntervalTime))},n.prototype.doOnline=function(t){var n=this;return new Promise((function(r,i){var s=function(t){var o=t.data,a=JSON.parse(o),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("Login"===E){n.removeMessageEventListener(s);var u=c.Code;if(0===u){var R=c.UserId;n._userId=R,r(R)}else O.error("user online failure, code => ",u),i(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_UNKNOWN,"Error Code "+u))}};n.addMessageEventListener(s);var a={Cmd:"Login"};a.AppId=n._appId,a.Encrypt=n._cmdEncrypt;var E=o({},t);L&&(E.SvrKeepAlive=!0),a.Content=JSON.stringify(E),n.send(a)}))},n.prototype.doOffline=function(){var e=this;return new Promise((function(t,n){var r=function(o){var i=o.data,s=JSON.parse(i),a=s.Cmd;s.Encrypt;var E=s.Content,_=JSON.parse(E);if("Logout"===a){e.removeMessageEventListener(r);var c=_.Code;0===c?t():n(c)}};e.addMessageEventListener(r);var o={Cmd:"Logout"};o.Encrypt=e._cmdEncrypt,o.Content="",e.send(o)}))},n.prototype.doQueryOnlineStatus=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(e){var r=e.data,s=JSON.parse(r),a=s.Cmd;s.Encrypt;var E=s.Content,_=JSON.parse(E);if("QueryOnlineStatus"===a){var c=_.MsgId,u=_.Status;c===o&&(t.removeMessageEventListener(i),n(u))}};t.addMessageEventListener(i);var s={Cmd:"QueryOnlineStatus"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify({MsgId:o,UserIds:JSON.stringify(e)}),t.send(s)}))},n.prototype.doQueryOnlineSubStatus=function(){var e=this;return new Promise((function(t,n){var r=d(),o=function(n){var i=n.data,s=JSON.parse(i),a=s.Cmd;s.Encrypt;var E=s.Content,_=JSON.parse(E);if("QueryOnlineSubStatus"===a){var c=_.MsgId,u=_.Status;c===r&&(e.removeMessageEventListener(o),t(u))}};e.addMessageEventListener(o);var i={Cmd:"QueryOnlineSubStatus"};i.Encrypt=e._cmdEncrypt,i.Content=JSON.stringify({MsgId:r}),e.send(i)}))},n.prototype.doSubscribeOnlineStatus=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(e){var s=e.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("SubscribeOnlineStatus"===E){var u=c.MsgId,R=c.Code;u===o&&(t.removeMessageEventListener(i),0===R?n():r(R))}};t.addMessageEventListener(i);var s={Cmd:"SubscribeOnlineStatus"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify({MsgId:o,UserIds:JSON.stringify(e)}),t.send(s)}))},n.prototype.doUnSubscribeOnlineStatus=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(e){var s=e.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("UnSubscribeOnlineStatus"===E){var u=c.MsgId,R=c.Code;u===o&&(t.removeMessageEventListener(i),0===R?n():r(R))}};t.addMessageEventListener(i);var s={Cmd:"UnSubscribeOnlineStatus"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify({MsgId:o,UserIds:JSON.stringify(e)}),t.send(s)}))},n.prototype.doSendMsgToPeer=function(e,t,n,r,o){var i=this;void 0===r&&(r=!1),void 0===o&&(o=!1);var s=this;return new Promise((function(a,E){if(s._websocket&&1===s._websocket.readyState){var _=d(),c=setTimeout((function(){}),0),u=function(e){var t=e.data,n=JSON.parse(t),r=n.Cmd;n.Encrypt;var o=n.Content,i=JSON.parse(o);if("MsgStatus"===r){var E=i.MsgId,R=i.Status;E===_&&(c&&clearTimeout(c),0===R?(s.removeMessageEventListener(u),a(!1)):(s.removeMessageEventListener(u),a(!0)))}};s.addMessageEventListener(u);var R={Cmd:"SendMsgToPeer"};R.Encrypt=s._cmdEncrypt,R.Content=JSON.stringify(Object.assign({MsgId:_,FromUId:s._userId,ToUId:t,MsgType:e,MsgBody:n,OfflineMsg:r,HistoryMsg:o,Desc:""})),s.send(R),c=setTimeout((function(){s.removeMessageEventListener(u),c&&clearTimeout(c),E("TimeOut")}),i._sendMsgTimeOutInterval)}else E()}))},n.prototype.doRecvMsgFromPeerAck=function(e,t){var n=this;if(!n._websocket||1!==n._websocket.readyState)return!1;var r={Cmd:"RecvMsgFromPeerAck"};r.Encrypt=n._cmdEncrypt,r.Content=JSON.stringify(Object.assign({MsgId:e,FromUId:t})),n.send(r)},n.prototype.doAddOrUpdateUserAttributes=function(e,t){void 0===t&&(t=!1);var n=this;return new Promise((function(r,o){var i=d(),s=function(e){var t=e.data,a=JSON.parse(t),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_),u=c.MsgId;if("AddOrUpdateUserAttributes"===E&&u===i){var R=c.Code;n.removeMessageEventListener(s),0===R?r():o(R)}};n.addMessageEventListener(s);var a={Cmd:"AddOrUpdateUserAttributes"};a.Encrypt=n._cmdEncrypt,a.Content=JSON.stringify(Object.assign({MsgId:i,SetLocal:t,Attributes:JSON.stringify(e)})),n.send(a)}))},n.prototype.doDeleteUserAttributes=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(e){var s=e.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("DeleteUserAttributes"===E){var u=c.Code,R=c.MsgId;o===R&&(t.removeMessageEventListener(i),0===u?n(!0):r(u))}};t.addMessageEventListener(i);var s={Cmd:"DeleteUserAttributes"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify(Object.assign({MsgId:o,Keys:JSON.stringify(e)})),t.send(s)}))},n.prototype.doClearUserAttributes=function(){var e=this;return new Promise((function(t,n){var r=d(),o=function(i){var s=i.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("ClearUserAttributes"===E){var u=c.Code;c.MsgId===r&&(e.removeMessageEventListener(o),0===u?t(!0):n(u))}};e.addMessageEventListener(o);var i={Cmd:"ClearUserAttributes"};i.Encrypt=e._cmdEncrypt,i.Content=JSON.stringify(Object.assign({MsgId:r})),e.send(i)}))},n.prototype.doGetUserAttributes=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(r){var s=r.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("QueryAttribKeys"===E){var u=c.QueryUserId,R=c.MsgId,l=c.Attribs;u===e&&o===R&&(t.removeMessageEventListener(i),n(JSON.parse(""!==l?l:[])))}};t.addMessageEventListener(i);var s={Cmd:"GetUserAttributes"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify(Object.assign({MsgId:o,UserId:e})),t.send(s)}))},n.prototype.doGetUserAttributesByKeys=function(e,t){var n=this;return new Promise((function(r,o){var i=d(),s=function(t){var o=t.data,a=JSON.parse(o),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("QueryAttribKeys"===E){var u=c.QueryUserId,R=c.MsgId,l=c.Attribs;u===e&&R===i&&(n.removeMessageEventListener(s),r(JSON.parse(l)))}};n.addMessageEventListener(s);var a={Cmd:"GetUserAttributes"};a.Encrypt=n._cmdEncrypt,a.Content=JSON.stringify(Object.assign({MsgId:i,UserId:e,Keys:t})),n.send(a)}))},n.prototype.doJoinChannel=function(e){var t=this;return new Promise((function(n,r){var o=function(i){var s=i.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("JoinChannel"===E){var u=c.Code,R=c.ChanId;e===R&&(t.removeMessageEventListener(o),0===u?n():r(u))}};t.addMessageEventListener(o);var i={Cmd:"JoinChannel"};i.Encrypt=t._cmdEncrypt,i.Content=JSON.stringify(Object.assign({ChanId:e})),t.send(i)}))},n.prototype.doSendChannelMsg=function(e,t,n,r){void 0===r&&(r=!1);var o=this;return new Promise((function(i,s){var a=d(),E=function(e){var n=e.data,r=JSON.parse(n),_=r.Cmd;r.Encrypt;var c=r.Content,u=JSON.parse(c);if("SendChannelMsg"===_){var R=u.Code,l=u.ChanId,d=u.MsgId;l===t&&a===d&&(o.removeMessageEventListener(E),0===R?i():s(R))}};o.addMessageEventListener(E);var _={Cmd:"SendChannelMsg"};_.Encrypt=o._cmdEncrypt,_.Content=JSON.stringify(Object.assign({ChanId:t,FromUId:o._userId,MsgId:a,MsgType:e,MsgBody:n,HistoryMsg:r,Desc:""})),o.send(_)}))},n.prototype.doLeaveChannel=function(e){var t=this;return new Promise((function(n,r){var o=function(i){var s=i.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("LeaveChannel"===E){var u=c.Code,R=c.ChanId;e===R&&(t.removeMessageEventListener(o),0===u?n():r(u))}};t.addMessageEventListener(o);var i={Cmd:"LeaveChannel"};i.Encrypt=t._cmdEncrypt,i.Content=JSON.stringify(Object.assign({ChanId:e})),t.send(i)}))},n.prototype.doAddOrUpdateChanAttributes=function(e){var t=this,n=e.channelId,r=e.attributes,o=e.notify,i=void 0!==o&&o,s=e.isSet,a=void 0!==s&&s;return new Promise((function(e,o){var s=d(),E=function(r){var i=r.data,a=JSON.parse(i),_=a.Cmd;a.Encrypt;var c=a.Content,u=JSON.parse(c);if("AddOrUpdateChanAttributes"===_){var R=u.Code,l=u.MsgId;u.ChanId===n&&s===l&&(t.removeMessageEventListener(E),0===R?e():o(R))}};t.addMessageEventListener(E);var _={Cmd:"AddOrUpdateChanAttributes"};_.Encrypt=t._cmdEncrypt,_.Content=JSON.stringify(Object.assign({MsgId:s,SetChan:a,ChanId:n,Attributes:JSON.stringify(r),Notify:i})),t.send(_)}))},n.prototype.doDeleteChanAttributes=function(e){var t=this,n=e.channelId,r=e.attributeKeys,o=e.notify;return new Promise((function(e,i){var s=d(),a=function(n){var r=n.data,o=JSON.parse(r),E=o.Cmd;o.Encrypt;var _=o.Content,c=JSON.parse(_);if("DeleteChanAttributes"===E){var u=c.Code,R=c.MsgId;c.ChanId,R===s&&(t.removeMessageEventListener(a),0===u?e():i(u))}};t.addMessageEventListener(a);var E={Cmd:"DeleteChanAttributes"};E.Encrypt=t._cmdEncrypt,E.Content=JSON.stringify(Object.assign({MsgId:s,ChanId:n,Keys:JSON.stringify(r),Notify:o})),t.send(E)}))},n.prototype.doGetChanAttributes=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(s){var a=s.data,E=JSON.parse(a),_=E.Cmd;E.Encrypt;var c=E.Content,u=JSON.parse(c);if("GetChanAttributes"===_){var R=u.Code,l=u.MsgId,d=u.ChanId,N=u.Attributes;e===d&&o===l&&(t.removeMessageEventListener(i),0===R?n(JSON.parse(""===N?"[]":N)):r(R))}};t.addMessageEventListener(i);var s={Cmd:"GetChanAttributes"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify(Object.assign({MsgId:o,ChanId:e})),t.send(s)}))},n.prototype.doGetChanAttributesByKeys=function(e,t){var n=this;return new Promise((function(r,o){var i=d(),s=function(t){var a=t.data,E=JSON.parse(a),_=E.Cmd;E.Encrypt;var c=E.Content,u=JSON.parse(c);if("GetChanAttributesByKeys"===_){var R=u.Code,l=u.MsgId,d=u.ChanId,N=u.Attributes;e===d&&i===l&&(n.removeMessageEventListener(s),0===R?r(""!==N?JSON.parse(N):[]):o(R))}};n.addMessageEventListener(s);var a={Cmd:"GetChanAttributesByKeys"};a.Encrypt=n._cmdEncrypt,a.Content=JSON.stringify(Object.assign({MsgId:i,ChanId:e,Keys:JSON.stringify(t)})),n.send(a)}))},n.prototype.doClearChanAttributes=function(e){var t=this,n=e.channelId,r=e.notify;return new Promise((function(e,o){var i=d(),s=function(n){var r=n.data,a=JSON.parse(r),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("ClearChanAttributes"===E){var u=c.Code;c.MsgId===i&&(t.removeMessageEventListener(s),0===u?e(!0):o(u))}};t.addMessageEventListener(s);var a={Cmd:"ClearChanAttributes"};a.Encrypt=t._cmdEncrypt,a.Content=JSON.stringify(Object.assign({MsgId:i,ChanId:n,Notify:r})),t.send(a)}))},n.prototype.doGetChanMemberSize=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(e){var s=e.data,a=JSON.parse(s),E=a.Cmd;a.Encrypt;var _=a.Content,c=JSON.parse(_);if("GetChanMemberSize"===E){var u=c.Code,R=c.ChanMemSize;c.MsgId===o&&(t.removeMessageEventListener(i),0===u?n(R):r(u))}};t.addMessageEventListener(i);var s={Cmd:"GetChanMemberSize"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify(Object.assign({MsgId:o,ChanIds:JSON.stringify(e)})),t.send(s)}))},n.prototype.doGetChanMembers=function(e){var t=this;return new Promise((function(n,r){var o=d(),i=function(s){var a=s.data,E=JSON.parse(a),_=E.Cmd;E.Encrypt;var c=E.Content,u=JSON.parse(c);if("GetChanMembers"===_){var R=u.Code,l=u.MsgId,d=u.Members,N=u.ChanId;e===N&&o===l&&(t.removeMessageEventListener(i),0===R?n(d):r(R))}};t.addMessageEventListener(i);var s={Cmd:"GetChanMembers"};s.Encrypt=t._cmdEncrypt,s.Content=JSON.stringify(Object.assign({MsgId:o,ChanId:e})),t.send(s)}))},n.prototype.doMakeCall=function(e,t,n){var r=this,o={Cmd:"MakeCall"};o.Encrypt=r._cmdEncrypt,o.Content=JSON.stringify(Object.assign({CallId:e,FromUId:r._userId,ToUId:t,Content:n})),r.send(o)},n.prototype.doCancelCall=function(e,t,n,r){void 0===n&&(n=""),void 0===r&&(r="");var o=this;return new Promise((function(i,s){var a=function(n){var r=n.data,E=JSON.parse(r),_=E.Cmd;E.Encrypt;var c=E.Content,u=JSON.parse(c);if("cancelCallAck"===_){var R=u.Code,l=u.CallId,d=u.FromUId,N=u.ToUId;l===e&&d===o._userId&&N===t&&(o.removeMessageEventListener(a),0===R?i():s(R))}};o.addMessageEventListener(a);var E={Cmd:"CancelCall"};E.Encrypt=o._cmdEncrypt,E.Content=JSON.stringify(Object.assign({CallId:e,FromUId:o._userId,ToUId:t,Reason:n,Content:r})),o.send(E)}))},n.prototype.doAcceptCall=function(e,t,n){var r=this,o={Cmd:"AcceptCall"};o.Encrypt=r._cmdEncrypt,o.Content=JSON.stringify(Object.assign({CallId:e,FromUId:r._userId,ToUId:t,Response:n})),r.send(o)},n.prototype.doRefuseCall=function(e,t,n){var r=this,o={Cmd:"RejectCall"};o.Encrypt=r._cmdEncrypt,o.Content=JSON.stringify(Object.assign({CallId:e,FromUId:r._userId,ToUId:t,Response:n})),r.send(o)},n.prototype.doReNewToken=function(e){var t={Cmd:"RenewAcsToken"};t.Content=JSON.stringify({AcsToken:e}),this.send(t)},n.prototype.disconnectServer=function(e){var t=this;if(t._stopKeepAlive(),t._clearKeepALiveTimeout(),t.clear(),e)switch(e){case"UID_BANNED":t._emitConnectionState("DISCONNECTED","UID_BANNED");break;case"TOKEN_INVALID":t._emitConnectionState("DISCONNECTED","TOKEN_INVALID")}else t._emitConnectionState("DISCONNECTED","LEAVE")},n.prototype._setConnectTimeout=function(){var e=this;e._clearConnectTimeout(),e._connectTimeout=setTimeout((function(){e._emitConnectionState("DISCONNECTING","NETWORK_ERROR")}),1e4)},n.prototype._startKeepAlive=function(){var e=this;e._stopKeepAlive(),e.doKeepAlive(),e._keepALiveInterval=setInterval((function(){e.doKeepAlive()}),e._keepALiveIntervalTime)},n.prototype._stopKeepAlive=function(){var e=this;e._keepALiveInterval&&(clearInterval(e._keepALiveInterval),e._keepALiveInterval=null)},n.prototype._clearConnectTimeout=function(){var e=this;e._connectTimeout&&(clearTimeout(e._connectTimeout),e._connectTimeout=null)},n.prototype._clearKeepALiveTimeout=function(){var e=this;e._keepAliveTimeout&&(clearTimeout(e._keepAliveTimeout),e._keepAliveTimeout=null)},n.prototype._emitConnectionState=function(e,t){"DISCONNECTED"===e&&O.debug("[signal] media websocket closed, reason: "+t),this._revState=this._curState,this._curState=e,this.handleMediaServerEvents&&this.handleMediaServerEvents("connection-state-change",{curState:this._curState,revState:this._revState,reason:t})},n}(v),te=function(){function e(){this._events={}}return e.prototype.on=function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})},e.prototype.once=function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})},e.prototype.off=function(e,t){this._events[e]||(this._events[e]=[]);var n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1)},e.prototype.removeAllListeners=function(e){e?delete this._events[e]:this._events={}},e.prototype.emit=function(e){for(var t,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];this._events[e]||(this._events[e]=[]);var i=this._events[e];try{for(var s=a(i),E=s.next();!E.done;E=s.next()){var _=E.value;_.once&&this.off(e,_.listener),_.listener.apply(this,r||[])}}catch(e){t={error:e}}finally{try{E&&!E.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},e.prototype._indexOfListener=function(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1},e}();e.RtmStatusCode=void 0,g=e.RtmStatusCode||(e.RtmStatusCode={}),(y=g.ConnectionChangeReason||(g.ConnectionChangeReason={})).BANNED_BY_SERVER="BANNED_BY_SERVER",y.INTERRUPTED="INTERRUPTED",y.LOGIN="LOGIN",y.LOGIN_FAILURE="LOGIN_FAILURE",y.LOGIN_SUCCESS="LOGIN_SUCCESS",y.LOGIN_TIMEOUT="LOGIN_TIMEOUT",y.LOGOUT="LOGOUT",y.REMOTE_LOGIN="REMOTE_LOGIN",(U=g.ConnectionState||(g.ConnectionState={})).ABORTED="ABORTED",U.CONNECTED="CONNECTED",U.CONNECTING="CONNECTING",U.DISCONNECTED="DISCONNECTED",U.RECONNECTING="RECONNECTING",(M=g.LocalInvitationFailureReason||(g.LocalInvitationFailureReason={})).INVITATION_EXPIRE="INVITATION_EXPIRE",M.NOT_LOGGEDIN="NOT_LOGGEDIN",M.PEER_NO_RESPONSE="PEER_NO_RESPONSE",M.PEER_OFFLINE="PEER_OFFLINE",(b=g.LocalInvitationState||(g.LocalInvitationState={})).ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",b.CANCELED="CANCELED",b.FAILURE="FAILURE",b.IDLE="IDLE",b.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",b.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",b.SENT_TO_REMOTE="SENT_TO_REMOTE",(g.MessageType||(g.MessageType={})).TEXT="TEXT",(w=g.PeerOnlineState||(g.PeerOnlineState={})).OFFLINE="OFFLINE",w.ONLINE="ONLINE",w.UNREACHABLE="UNREACHABLE",(g.PeerSubscriptionOption||(g.PeerSubscriptionOption={})).ONLINE_STATUS="ONLINE_STATUS",(D=g.RemoteInvitationFailureReason||(g.RemoteInvitationFailureReason={})).ACCEPT_FAILURE="ACCEPT_FAILURE",D.INVITATION_EXPIRE="INVITATION_EXPIRE",D.PEER_OFFLINE="PEER_OFFLINE",(G=g.RemoteInvitationState||(g.RemoteInvitationState={})).ACCEPTED="ACCEPTED",G.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",G.CANCELED="CANCELED",G.FAILURE="FAILURE",G.INVITATION_RECEIVED="INVITATION_RECEIVED",G.REFUSED="REFUSED",e.RtmErrorCode=void 0,P=e.RtmErrorCode||(e.RtmErrorCode={}),(B=P.BasicErrorCode||(P.BasicErrorCode={}))[B.INVALID_OPERATION=1]="INVALID_OPERATION",(F=P.AttributeOperationError||(P.AttributeOperationError={}))[F.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",F[F.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",F[F.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",F[F.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",F[F.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",F[F.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",F[F.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN",(V=P.ChannelMessageError||(P.ChannelMessageError={}))[V.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",V[V.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",V[V.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",V[V.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",V[V.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",V[V.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN",(J=P.CreateChannelError||(P.CreateChannelError={}))[J.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT",(W=P.CreateInstanceError||(P.CreateInstanceError={}))[W.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT",(k=P.GetChannelMemberCountErrCode||(P.GetChannelMemberCountErrCode={}))[k.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",k[k.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",k[k.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",k[k.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",k[k.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",k[k.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",k[k.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN",(Y=P.GetMembersError||(P.GetMembersError={}))[Y.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",Y[Y.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",Y[Y.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",Y[Y.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",Y[Y.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",Y[Y.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=6]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN",(H=P.InvitationApiCallError||(P.InvitationApiCallError={}))[H.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",H[H.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",H[H.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",H[H.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",H[H.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT",(K=P.JoinChannelError||(P.JoinChannelError={}))[K.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",K[K.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",K[K.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",K[K.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",K[K.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",K[K.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",K[K.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",K[K.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",K[K.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",K[K.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=210]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",K[K.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=211]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID",(j=P.LeaveChannelError||(P.LeaveChannelError={}))[j.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",j[j.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",j[j.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",j[j.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN",(x=P.LoginError||(P.LoginError={}))[x.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",x[x.LOGIN_ERR_INVALID_ARGUMENT=2]="LOGIN_ERR_INVALID_ARGUMENT",x[x.LOGIN_ERR_INVALID_APP_ID=3]="LOGIN_ERR_INVALID_APP_ID",x[x.LOGIN_ERR_INVALID_TOKEN=4]="LOGIN_ERR_INVALID_TOKEN",x[x.LOGIN_ERR_TOKEN_EXPIRED=5]="LOGIN_ERR_TOKEN_EXPIRED",x[x.LOGIN_ERR_NOT_AUTHORIZED=6]="LOGIN_ERR_NOT_AUTHORIZED",x[x.LOGIN_ERR_ALREADY_LOGIN=7]="LOGIN_ERR_ALREADY_LOGIN",x[x.LOGIN_ERR_TIMEOUT=8]="LOGIN_ERR_TIMEOUT",x[x.LOGIN_ERR_TOO_OFTEN=9]="LOGIN_ERR_TOO_OFTEN",x[x.LOGIN_ERR_ABORTED_BY_LOGOUT=10]="LOGIN_ERR_ABORTED_BY_LOGOUT",x[x.LOGIN_ERR_GATEWAY_CONNECT_FAILED=11]="LOGIN_ERR_GATEWAY_CONNECT_FAILED",(Q=P.LogoutError||(P.LogoutError={}))[Q.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN",(X=P.PeerMessageError||(P.PeerMessageError={}))[X.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",X[X.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",X[X.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",X[X.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",X[X.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",X[X.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN",(z=P.PeerSubscriptionStatusError||(P.PeerSubscriptionStatusError={}))[z.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",z[z.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",z[z.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",z[z.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",z[z.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",z[z.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",z[z.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN",($=P.QueryPeersBySubscriptionOptionError||(P.QueryPeersBySubscriptionOptionError={}))[$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",$[$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",$[$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",$[$.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN",(Z=P.QueryPeersOnlineStatusError||(P.QueryPeersOnlineStatusError={}))[Z.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=0]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",Z[Z.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=1]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",Z[Z.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",Z[Z.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=3]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",Z[Z.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN",(q=P.RenewTokenError||(P.RenewTokenError={}))[q.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",q[q.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",q[q.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",q[q.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",q[q.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",q[q.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",q[q.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",q[q.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT";var ne,re=function(t){function n(e,n){var r=t.call(this)||this;return r.memberCount=0,r.attributes={},r.channelId="",r.client=e,r.channelId=n,r.bindChannelEvents=r._handleChannelEvents.bind(r),r}return r(n,t),n.prototype.getMembers=function(){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return n=(t=this).client._rtmServer,""===this.client.uid?[3,2]:[4,n.doGetChanMembers(t.channelId)];case 1:return[2,r.sent()];case 2:throw new A(e.RtmErrorCode.GetMembersError.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,"The client is not logged in. Cannot do the operation.")}}))}))},n.prototype.join=function(){return i(this,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:if(t=this,""===this.client.uid)throw new A(e.RtmErrorCode.JoinChannelError.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,"The client is not logged in. Cannot do the operation.");return t.client.channels[t.channelId].joined?[3,3]:(n=t.client._rtmServer)?(n.addMessageEventListener(this.bindChannelEvents),[4,n.doJoinChannel(t.channelId)]):[3,2];case 1:return r.sent(),t.client.channels[t.channelId].joined=!0,O.info("join channel "+t.channelId+" success."),[2];case 2:return[3,4];case 3:throw new h(e.RtmErrorCode.JoinChannelError.JOIN_CHANNEL_ERR_ALREADY_JOINED,"The channel has joined. Cannot rejoin.");case 4:return[2]}}))}))},n.prototype.leave=function(){return i(this,void 0,void 0,(function(){var t,n,r;return s(this,(function(o){switch(o.label){case 0:if(t=this,""===this.client.uid)throw new A(e.RtmErrorCode.JoinChannelError.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,"The client is not logged in. Cannot do the operation.");return(n=t.client.channels[t.channelId]).joined?(r=t.client._rtmServer)?[4,r.doLeaveChannel(t.channelId)]:[3,2]:[3,3];case 1:return o.sent(),n.joined=!1,O.info("leave channel "+t.channelId+" success."),r.removeMessageEventListener(t.bindChannelEvents),[2];case 2:return[3,4];case 3:throw new h(e.RtmErrorCode.LeaveChannelError.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,"The channel does not join. Cannot do the operation.");case 4:return[2]}}))}))},n.prototype.sendMessage=function(t,n){return i(this,void 0,void 0,(function(){var r,o,i,a;return s(this,(function(s){switch(s.label){case 0:if(r=this,""===this.client.uid)throw new A(e.RtmErrorCode.ChannelMessageError.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,"The client is not logged in. Cannot do the operation.");return r.client.channels[r.channelId].joined?(o=(n||{enableHistoricalMessaging:!1}).enableHistoricalMessaging,(i=r.client._rtmServer)?(a=t.text)?(e.RtmStatusCode.MessageType.TEXT,[4,i.doSendChannelMsg(1,r.channelId,a,o)]):[3,2]:[3,3]):[3,4];case 1:return s.sent(),[2];case 2:throw new A(e.RtmErrorCode.ChannelMessageError.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,"Message is not valid.");case 3:return[3,5];case 4:throw new h(e.RtmErrorCode.ChannelMessageError.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,"The channel does not join. Cannot do the operation.");case 5:return[2]}}))}))},n.prototype._handleChannelEvents=function(e){var t=e.data,n=this,r=JSON.parse(t),o=r.Cmd;r.Encrypt;var i=r.Content,s=JSON.parse(i);if(s.ChanId===n.channelId)if("RecvMsgFromChan"===o){s.MsgId;var a=s.FromUId,E=s.MsgType,_=s.MsgBody,c={isOfflineMessage:!1,serverReceivedTs:s.SvrTS};if(1===E){var u={text:_};n.emit("ChannelMessage",u,a,c)}}else if("ChanMemberJoin"===o){var R=s.UserId;s.ChanMemSize,n.emit("MemberJoined",R)}else if("ChanMemberLeave"===o){R=s.UserId;s.ChanMemSize,n.emit("MemberLeft",R)}else if("MemSizeChanged"===o){var l=s.MemSize;n.emit("MemberCountUpdated",l)}else if("ChanAttribChanged"===o){var d=s.Attributes,N={};d.map((function(e){var t=e.Key,n=e.Val,r=e.UId,o=e.Time;N[t]={lastUpdateTs:o,lastUpdateUserId:r,value:n}})),n.emit("AttributesUpdated",N)}},n}(te),oe=function(t){function n(n,r,o){var i=t.call(this)||this;return i._callId="",i.calleeId="",i.content="",i.state=e.RtmStatusCode.LocalInvitationState.IDLE,i.response="",i.client=n,i._callId=r,i.calleeId=o,i}return r(n,t),n.prototype.cancel=function(){var t=this,n=t.client._rtmServer;if(n)if(t.state===e.RtmStatusCode.LocalInvitationState.ACCEPTED_BY_REMOTE||t.state===e.RtmStatusCode.LocalInvitationState.SENT_TO_REMOTE||t.state===e.RtmStatusCode.LocalInvitationState.FAILURE||t.state===e.RtmStatusCode.LocalInvitationState.RECEIVED_BY_REMOTE){var r=t.state===e.RtmStatusCode.LocalInvitationState.FAILURE?"TimeOut":"";n.doCancelCall(t._callId,t.calleeId,r,t.content),t.state!==e.RtmStatusCode.LocalInvitationState.FAILURE&&t.emit("LocalInvitationCanceled")}else if(t.state===e.RtmStatusCode.LocalInvitationState.IDLE)throw new h(e.RtmErrorCode.InvitationApiCallError.INVITATION_API_CALL_ERR_NOT_STARTED,"The call invitation is not send yet.")},n.prototype.send=function(){var t=this;if(t.state!==e.RtmStatusCode.LocalInvitationState.IDLE){if(t.state===e.RtmStatusCode.LocalInvitationState.SENT_TO_REMOTE)throw new h(e.RtmErrorCode.InvitationApiCallError.INVITATION_API_CALL_ERR_ALREADY_SENT,"The call invitation already sent.");if(t.state===e.RtmStatusCode.LocalInvitationState.ACCEPTED_BY_REMOTE||t.state===e.RtmStatusCode.LocalInvitationState.REFUSED_BY_REMOTE)throw new h(e.RtmErrorCode.InvitationApiCallError.INVITATION_API_CALL_ERR_ALREADY_END,"The call invitation already by accept.")}var n=t.client._rtmServer;n?(t.state=e.RtmStatusCode.LocalInvitationState.SENT_TO_REMOTE,n.doMakeCall(t._callId,t.calleeId,t.content)):t.emit("LocalInvitationFailure",e.RtmStatusCode.LocalInvitationFailureReason.NOT_LOGGEDIN)},n}(te),ie=function(t){function n(n,r,o){var i=t.call(this)||this;return i._callId="",i.callerId="",i.content="",i.response="",i._callId=n,i.callerId=r,i.content=o,i.state=e.RtmStatusCode.RemoteInvitationState.INVITATION_RECEIVED,i._timer=setTimeout((function(){i.state===e.RtmStatusCode.RemoteInvitationState.INVITATION_RECEIVED&&(i.state=e.RtmStatusCode.RemoteInvitationState.FAILURE,i.emit("RemoteInvitationFailure",e.RtmStatusCode.RemoteInvitationFailureReason.INVITATION_EXPIRE))}),6e4),i}return r(n,t),n.prototype.accept=function(){var t=this,n=t.client._rtmServer;if(n)if(t.state===e.RtmStatusCode.RemoteInvitationState.INVITATION_RECEIVED)n.doAcceptCall(t._callId,t.callerId,t.response),t.state=e.RtmStatusCode.RemoteInvitationState.ACCEPT_SENT_TO_LOCAL;else{if(t.state===e.RtmStatusCode.RemoteInvitationState.ACCEPTED)throw new h(e.RtmErrorCode.InvitationApiCallError.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,"The call invitation already by accept.");if(t.state===e.RtmStatusCode.RemoteInvitationState.REFUSED)throw new h(e.RtmErrorCode.InvitationApiCallError.INVITATION_API_CALL_ERR_ALREADY_END,"The call invitation already ended.")}this._timer&&clearTimeout(this._timer)},n.prototype.refuse=function(){var t=this,n=t.client._rtmServer;n&&t.state===e.RtmStatusCode.RemoteInvitationState.INVITATION_RECEIVED&&(n.doRefuseCall(t._callId,t.callerId,t.response),t.state=e.RtmStatusCode.RemoteInvitationState.REFUSED,t.emit("RemoteInvitationRefused")),this._timer&&clearTimeout(this._timer)},n}(te),se=function(n){function o(e,t){var r=n.call(this)||this;return r._useWss=!0,r._userAttributes={},r._localCall={},r._remoteCall={},r._sessionId="",r._joinStartTime=0,r.uid="",r.token=null,r.channels={},r.channelAttributesCacheLru={},r._sid=R.generateLowCaseString(32),r._appId=e,r.setParameters(t||{}),r}return r(o,n),o.prototype.addOrUpdateChannelAttributes=function(t,n,r){var o;return i(this,void 0,void 0,(function(){var i,a,E;return s(this,(function(s){switch(s.label){case 0:if(i=this,a=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,"string"!=typeof t||!a.test(t))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributes in the arguments is invalid.");if("[object Object]"!==Object.prototype.toString.call(n)||"{}"===JSON.stringify(n))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributes in the arguments is invalid.");return Object.keys(n).forEach((function(t){if(null==t||""===t)throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"Invalid attribute key.")})),Object.values(n).map((function(t,n){if(null==t||""===t)throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"Invalid attribute key.")})),""===i.uid?[3,2]:(E=(r||{enableNotificationToChannelMembers:!1}).enableNotificationToChannelMembers,[4,null===(o=i._rtmServer)||void 0===o?void 0:o.doAddOrUpdateChanAttributes({channelId:t,attributes:n,notify:E})]);case 1:return s.sent(),i.channelAttributesCacheLru[t]=n,[2];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.addOrUpdateLocalUserAttributes=function(t){var n;return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:if(r=this,"[object Object]"!==Object.prototype.toString.call(t)||"{}"===JSON.stringify(t))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributes in the arguments is invalid.");return Object.keys(t).forEach((function(t){if(null==t||""===t)throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"Invalid attribute value.")})),Object.values(t).map((function(t,n){if(null==t||""===t)throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"Invalid attribute key.")})),""===r.uid?[3,2]:[4,null===(n=r._rtmServer)||void 0===n?void 0:n.doAddOrUpdateUserAttributes(t)];case 1:return o.sent(),r._userAttributes=t,[2];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.clearChannelAttributes=function(t,n){var r;return i(this,void 0,void 0,(function(){var o,i,a;return s(this,(function(s){switch(s.label){case 0:if(o=this,i=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,"string"!=typeof t||!i.test(t))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributes in the arguments is invalid.");return""===o.uid?[3,2]:(a=(n||{enableNotificationToChannelMembers:!1}).enableNotificationToChannelMembers,[4,null===(r=o._rtmServer)||void 0===r?void 0:r.doClearChanAttributes({channelId:t,notify:a})]);case 1:return s.sent(),o.channelAttributesCacheLru[t]&&delete o.channelAttributesCacheLru[t],[2];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.clearLocalUserAttributes=function(){var t;return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return""===(n=this).uid?[3,2]:[4,null===(t=n._rtmServer)||void 0===t?void 0:t.doClearUserAttributes()];case 1:return r.sent(),n._userAttributes={},[2];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.createChannel=function(t){if("string"!=typeof t||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t)||"null"===t)throw new A(e.RtmErrorCode.CreateChannelError.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,"The channelId in the arguments is invalid.");var n=new re(this,t);return this.channels[t]={channel:n,joined:!1},n},o.prototype.createLocalInvitation=function(t){if("string"!=typeof t)throw new A(e.RtmErrorCode.InvitationApiCallError.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,"The calleeId in the arguments is invalid.");var n=R.generateLowCaseString(32),r=new oe(this,n,t);return this._localCall[n]=r,r},o.prototype.deleteChannelAttributesByKeys=function(t,n,r){var o;return i(this,void 0,void 0,(function(){var i,a,E,_;return s(this,(function(s){switch(s.label){case 0:if(""===(i=this).uid)return[3,2];if(a=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,"string"!=typeof t||!a.test(t))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The channelId in the arguments is invalid.");if(!(n instanceof Array))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributeKeys in the arguments is not valid.");return E=(r||{enableNotificationToChannelMembers:!1}).enableNotificationToChannelMembers,[4,null===(o=i._rtmServer)||void 0===o?void 0:o.doDeleteChanAttributes({channelId:t,attributeKeys:n,notify:E})];case 1:return s.sent(),i.channelAttributesCacheLru[t]&&(_=i.channelAttributesCacheLru[t],Object.keys(_).map((function(e){_.hasOwnProperty(e)&&delete _[e]}))),[2];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.deleteLocalUserAttributesByKeys=function(t){var n;return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:if(r=this,!(t instanceof Array))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributeKeys in the arguments is not valid.");return""===r.uid?[3,2]:[4,null===(n=r._rtmServer)||void 0===n?void 0:n.doDeleteUserAttributes(t)];case 1:return o.sent(),t.map((function(e){r._userAttributes.hasOwnProperty(e)&&delete r._userAttributes[e]})),[2];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.getChannelAttributes=function(t){var n;return i(this,void 0,void 0,(function(){var r,o,i,a,E;return s(this,(function(s){switch(s.label){case 0:if(r=this,o=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,"string"!=typeof t||!o.test(t))throw new A(e.RtmErrorCode.CreateChannelError.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,"The channelId in the arguments is invalid.");return""===r.uid?[3,2]:[4,null===(n=r._rtmServer)||void 0===n?void 0:n.doGetChanAttributes(t)];case 1:return i=s.sent(),a={},E={},i.map((function(e){var t=e.Key,n=e.Val,r=e.UId,o=e.Time;a[t]=n,E[t]={lastUpdateTs:o,lastUpdateUserId:r,value:n}})),r.channelAttributesCacheLru[t]=a,[2,E];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.getChannelAttributesByKeys=function(t,n){var r;return i(this,void 0,void 0,(function(){var o,i,a,E,_;return s(this,(function(s){switch(s.label){case 0:if(o=this,i=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,"string"!=typeof t||!i.test(t))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The channelId in the arguments is invalid.");if(!(n instanceof Array))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributeKeys in the arguments is not valid.");return""===o.uid?[3,2]:[4,null===(r=o._rtmServer)||void 0===r?void 0:r.doGetChanAttributesByKeys(t,n)];case 1:return a=s.sent(),E=o.channelAttributesCacheLru[t]||{},_={},a.map((function(e){var t=e.Key,n=e.Val,r=e.UId,o=e.Time;_[t]={lastUpdateTs:o,lastUpdateUserId:r,value:n},E[t]=n})),[2,_];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.getChannelMemberCount=function(t){var n;return i(this,void 0,void 0,(function(){var r,o;return s(this,(function(i){switch(i.label){case 0:if(r=this,"[object Array]"!==Object.prototype.toString.call(t))throw new A(e.RtmErrorCode.GetChannelMemberCountErrCode.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT,"The channelIds in the arguments is invalid.");if(t.length>32)throw new A(e.RtmErrorCode.GetChannelMemberCountErrCode.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT,"The channelIds is out of length.");return""===r.uid?[3,4]:r._rtmServer?(o={},[4,null===(n=r._rtmServer)||void 0===n?void 0:n.doGetChanMemberSize(t)]):[3,2];case 1:return i.sent().map((function(e){o[e.ChanId]=e.MemSize})),[2,o];case 2:throw new A(e.RtmErrorCode.GetChannelMemberCountErrCode.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED,"The RTM server is not initialized yet.");case 3:return[3,5];case 4:throw new A(e.RtmErrorCode.GetChannelMemberCountErrCode.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.");case 5:return[2]}}))}))},o.prototype.getUserAttributes=function(t){var n;return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:if(r=this,"string"!=typeof t)throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The channelId in the arguments is invalid.");return""===r.uid?[3,2]:[4,null===(n=r._rtmServer)||void 0===n?void 0:n.doGetUserAttributes(t)];case 1:return[2,o.sent()];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.getUserAttributesByKeys=function(t,n){var r;return i(this,void 0,void 0,(function(){var o;return s(this,(function(i){switch(i.label){case 0:if(""===(o=this).uid)return[3,2];if("string"!=typeof t||!(n instanceof Array))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"arguments is not valid.");return[4,null===(r=o._rtmServer)||void 0===r?void 0:r.doGetUserAttributesByKeys(t,n)];case 1:return[2,i.sent()];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.login=function(t){var n=this,r=this;if(""!==r.uid)return Promise.reject(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_ALREADY_LOGIN,"The SDK is either logging in or has logged in the RTM system."));var o=t.token,a=t.uid;if(r.uid)return O.warning("already connected to room "+r.uid),Promise.resolve();if(r.connectFuture)return r.connectFuture.promise;if(r.reconnectFuture)return r.connectFuture=r.reconnectFuture,r.connectFuture.promise;return r.connectFuture=new N((function(t,_){return i(n,void 0,void 0,(function(){var n,i,c,u,R,l,d,N,I,T;return s(this,(function(s){switch(s.label){case 0:return r._emitConnectionState(e.RtmStatusCode.ConnectionState.CONNECTING,e.RtmStatusCode.ConnectionChangeReason.LOGIN),n=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,""===a||null==a||n.test(a)&&"string"==typeof a&&"null"!==a?o&&"string"!=typeof o?(_(new A(e.RtmErrorCode.LoginError.LOGIN_ERR_INVALID_ARGUMENT,"The uid length must be string within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),[2]):(this._joinStartTime=Date.now(),r._createRtmServerInstance(),[4,S(r._authGateWay(a,o))]):(_(new A(e.RtmErrorCode.LoginError.LOGIN_ERR_INVALID_ARGUMENT,"The uid length must be string within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),[2]);case 1:if(i=E.apply(void 0,[s.sent(),2]),c=i[0],u=i[1],!c)return[3,2];switch(R=e.RtmStatusCode.ConnectionChangeReason.LOGIN_FAILURE,c.code){case e.RtmErrorCode.LoginError.LOGIN_ERR_INVALID_ARGUMENT:R=e.RtmStatusCode.ConnectionChangeReason.LOGIN_FAILURE;break;case e.RtmErrorCode.LoginError.LOGIN_ERR_INVALID_APP_ID:R=e.RtmStatusCode.ConnectionChangeReason.BANNED_BY_SERVER;break;case e.RtmErrorCode.LoginError.LOGIN_ERR_TIMEOUT:R=e.RtmStatusCode.ConnectionChangeReason.LOGIN_TIMEOUT}return r._emitConnectionState(e.RtmStatusCode.ConnectionState.DISCONNECTED,R),_(c),[3,4];case 2:return u?t():_(),[4,S(this._gateway.getOfflineMsg({uid:r.uid}))];case 3:if(l=E.apply(void 0,[s.sent(),2]),d=l[0],N=l[1],d)return O.error("get offline message failed"),[2];N&&(I=N.code,T=N.data,0===I&&T.map((function(e){var t=e.msgFrom;e.msgStatus;var n=e.msgType,o=e.msgBody,i={isOfflineMessage:!0,serverReceivedTs:e.msgTs};if(1===n){var s={text:o};r.emit("MessageFromPeer",s,t,i)}}))),s.label=4;case 4:return[2]}}))}))}),(function(){r.clearConnectionFutures(),r._emitConnectionState(e.RtmStatusCode.ConnectionState.CONNECTED,e.RtmStatusCode.ConnectionChangeReason.LOGIN_SUCCESS)})),r.connectFuture.promise},o.prototype.clearConnectionFutures=function(){this.connectFuture=void 0,this.reconnectFuture=void 0},o.prototype.logout=function(){var t;return i(this,void 0,void 0,(function(){return s(this,(function(n){return""!==this.uid&&(null===(t=this._rtmServer)||void 0===t||t.doOffline(),this._rtmServer.disconnectServer(),this._rtmServer.handleMediaServerEvents=function(){},this._rtmServer=void 0,this.uid="",this.channels={},this._localCall={},this._remoteCall={},this._sessionId="",this.token="",this._joinStartTime=0,this._emitConnectionState(e.RtmStatusCode.ConnectionState.DISCONNECTED,e.RtmStatusCode.ConnectionChangeReason.LOGOUT)),[2]}))}))},o.prototype.queryPeersBySubscriptionOption=function(t){var n;return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:if(""===this.uid)throw new A(e.RtmErrorCode.QueryPeersBySubscriptionOptionError.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in. Cannot do the operation");if(!(t in e.RtmStatusCode.PeerSubscriptionOption))throw new A(e.RtmErrorCode.QueryPeersBySubscriptionOptionError.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,"");return r=[],e.RtmStatusCode.PeerSubscriptionOption.ONLINE_STATUS!==t?[3,2]:[4,null===(n=this._rtmServer)||void 0===n?void 0:n.doQueryOnlineSubStatus()];case 1:o.sent().map((function(e){1===e.Online&&r.push(e.UserId)})),o.label=2;case 2:return[2,r]}}))}))},o.prototype.queryPeersOnlineStatus=function(t){var n;return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:if(r={},""===this.uid)return[3,2];if(!(t instanceof Array&&t))throw new h(e.RtmErrorCode.QueryPeersOnlineStatusError.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT,"invalid arguments.");return[4,null===(n=this._rtmServer)||void 0===n?void 0:n.doQueryOnlineStatus(t)];case 1:return o.sent().map((function(e){r[e.UserId]=!!e.Online})),[2,r];case 2:throw new h(e.RtmErrorCode.QueryPeersOnlineStatusError.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}}))}))},o.prototype.renewToken=function(t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return n=this,[2,new Promise((function(r,o){var i;try{if(""===n.uid)throw new h(e.RtmErrorCode.RenewTokenError.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,"renewToken should not be called before user join");if(t&&"string"!=typeof t||!t)return void o(new A(e.RtmErrorCode.RenewTokenError.RENEW_TOKEN_ERR_INVALID_ARGUMENT,"The uid length must be string within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,"));O.info("set new token"),null===(i=n._rtmServer)||void 0===i||i.doReNewToken(t),r()}catch(e){o(e)}}))]}))}))},o.prototype.sendMessageToPeer=function(t,n,r){return i(this,void 0,void 0,(function(){var o,i,a,_,c,u,R,l,d,N;return s(this,(function(s){switch(s.label){case 0:if(i={hasPeerReceived:!1},""===(o=this).uid)return[3,4];if(!n)throw new A(e.RtmErrorCode.PeerMessageError.PEER_MESSAGE_ERR_INVALID_USERID,"The send message arguments are not valid.");if(a=t.text,_=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,""!==n&&null!=n&&(!_.test(n)||"string"!=typeof n))throw new A(e.RtmErrorCode.PeerMessageError.PEER_MESSAGE_ERR_INVALID_USERID,"The uid length must be string within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,");return u=(c=r||{enableHistoricalMessaging:!1,enableOfflineMessaging:!1}).enableHistoricalMessaging,R=c.enableOfflineMessaging,a?(e.RtmStatusCode.MessageType.TEXT,[4,S(o._rtmServer.doSendMsgToPeer(1,n,a,R,u))]):[3,2];case 1:if(l=E.apply(void 0,[s.sent(),2]),d=l[0],N=l[1],d)throw"TimeOut"===d?new h(e.RtmErrorCode.PeerMessageError.PEER_MESSAGE_ERR_TIMEOUT):new h(e.RtmErrorCode.PeerMessageError.PEER_MESSAGE_ERR_FAILURE,d);return i.hasPeerReceived=N,[2,i];case 2:throw new h(e.RtmErrorCode.PeerMessageError.PEER_MESSAGE_ERR_INVALID_MESSAGE,"Message is not valid.");case 3:return[3,5];case 4:throw new h(e.RtmErrorCode.PeerMessageError.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,"Failed to send the peer-to-peer message. The client is not logged in.");case 5:return[2]}}))}))},o.prototype.setChannelAttributes=function(t,n,r){return i(this,void 0,void 0,(function(){var o,i,a;return s(this,(function(s){switch(s.label){case 0:if(o=this,i=/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/,"string"!=typeof t||!i.test(t))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The channelId in the arguments is invalid.");if("[object Object]"!==Object.prototype.toString.call(n))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributes in the arguments is invalid.");return""===o.uid?[3,3]:(a=(r||{enableNotificationToChannelMembers:!1}).enableNotificationToChannelMembers,o._rtmServer?[4,o._rtmServer.doAddOrUpdateChanAttributes({channelId:t,attributes:n,isSet:!0,notify:a})]:[3,2]);case 1:return s.sent(),o.channelAttributesCacheLru[t]=n,[2];case 2:return[3,4];case 3:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.");case 4:return[2]}}))}))},o.prototype.setLocalUserAttributes=function(t){var n;return i(this,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:if(r=this,"[object Object]"!==Object.prototype.toString.call(t))throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,"The attributes in the arguments is invalid.");return""===r.uid?[3,2]:(r._userAttributes={},[4,null===(n=r._rtmServer)||void 0===n?void 0:n.doAddOrUpdateUserAttributes(t,!0)]);case 1:return o.sent(),r._userAttributes=t,[3,3];case 2:throw new A(e.RtmErrorCode.AttributeOperationError.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.");case 3:return[2]}}))}))},o.prototype.setParameters=function(e){var n=this,r=e.logFilter,o=e.confPriCloudAddr,i=e.ConfPriCloudAddr;if(r&&O.setLogLevel(r),o){var s=o.ServerAdd,a=o.Port,E=o.Wss;n._useWss="boolean"!=typeof E||E,s&&(t.GATEWAY_ADDRESS=(n._useWss?"https://"+s:"http://"+s)+(a?":"+a:""))}if(i){s=i.ServerAdd,a=i.Port,E=i.Wss;n._useWss="boolean"!=typeof E||E,s&&(t.GATEWAY_ADDRESS=(n._useWss?"https://"+s:"http://"+s)+(a?":"+a:""))}},o.prototype.subscribePeersOnlineStatus=function(t){var n;return i(this,void 0,void 0,(function(){return s(this,(function(r){if(""!==this.uid){if(!(t instanceof Array&&t))throw new h(e.RtmErrorCode.PeerSubscriptionStatusError.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT,"invalid arguments.");if(t.length<1||t.length>512)throw new h(e.RtmErrorCode.PeerSubscriptionStatusError.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,"The length of the subscriber must be greater than 0 and less than 512.");return null===(n=this._rtmServer)||void 0===n||n.doSubscribeOnlineStatus(t),[2]}throw new A(e.RtmErrorCode.PeerSubscriptionStatusError.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}))}))},o.prototype.unsubscribePeersOnlineStatus=function(t){var n;return i(this,void 0,void 0,(function(){return s(this,(function(r){if(""!==this.uid){if(!(t instanceof Array&&t))throw new h(e.RtmErrorCode.PeerSubscriptionStatusError.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT,"invalid arguments.");if(t.length<1||t.length>512)throw new h(e.RtmErrorCode.PeerSubscriptionStatusError.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,"The length of the subscriber must be greater than 0 and less than 512.");return null===(n=this._rtmServer)||void 0===n||n.doUnSubscribeOnlineStatus(t),[2]}throw new A(e.RtmErrorCode.PeerSubscriptionStatusError.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN,"The client is not logged in.")}))}))},o.prototype._emitConnectionState=function(e,t){this.emit("ConnectionStateChanged",e,t)},o.prototype._createRtmServerInstance=function(){var t=this,n=this;n._rtmServer||(n._rtmServer=new ee),n._rtmServer.handleMediaServerEvents=function(n,r){var o,i=t;if(r.Code,"connection-state-change"===n){var s=r.curState;if(r.reason,"RECONNECTING"===s){i._emitConnectionState(e.RtmStatusCode.ConnectionState.RECONNECTING);var a=i._userAttributes;i._userAttributes={},i._remoteCall={},i._localCall={},i.channelAttributesCacheLru={},Object.keys(i.channels).map((function(e){i.channels[e].joined=!1})),i._rtmServer=void 0,i._createRtmServerInstance(),i._authGateWay(i.uid,i.token).then((function(t){i.setLocalUserAttributes(a),Object.keys(i.channels).map((function(e){i.channels[e].channel.join()})),i._emitConnectionState(e.RtmStatusCode.ConnectionState.CONNECTED)}))}}else if("ForceOffline"===n||"AcsTokenDidExpire"===n){var E="";"ForceOffline"===n?t._emitConnectionState(e.RtmStatusCode.ConnectionState.DISCONNECTED,e.RtmStatusCode.ConnectionChangeReason.REMOTE_LOGIN):"AcsTokenDidExpire"===n&&(E="TOKEN_INVALID",i.emit("TokenDidExpired"),O.debug("[client}] token privilege did expire.")),t._rtmServer.disconnectServer(E),t._rtmServer.handleMediaServerEvents=function(){},t._rtmServer=void 0,t.uid="",t.channels={},t._localCall={},t._remoteCall={},t._sessionId="",t.token=""}else if("AcsTokenWillExpire"===n)i.emit("TokenWillExpired"),O.debug("[client] token privilege will expire.");else if("RecvMsgFromPeer"===n){var _=r.MsgId,c=r.FromUId,u=r.MsgType,R=r.MsgBody,l={isOfflineMessage:!1,serverReceivedTs:r.SvrTS};if(1===u){var d={text:R};i.emit("MessageFromPeer",d,c,l)}null===(o=i._rtmServer)||void 0===o||o.doRecvMsgFromPeerAck(_,c)}else if("PeerOnlineStatus"===n){var N=r.Status,I={};N.map((function(t){I[t.UserId]=t.Online?e.RtmStatusCode.PeerOnlineState.ONLINE:e.RtmStatusCode.PeerOnlineState.OFFLINE})),i.emit("PeersOnlineStatusChanged",I)}else if("MakeCall"===n){var T=r.CallId,C=r.FromUId;r.ToUId;var v=r.Content;(A=new ie(T,C,v)).client=i,i._remoteCall[T]=A,i.emit("RemoteInvitationReceived",A)}else if("CancelCall"===n){T=r.CallId,C=r.FromUId;r.ToUId;var h=r.Reason;v=r.Content;(A=i._remoteCall[T])&&(A.state=e.RtmStatusCode.RemoteInvitationState.CANCELED,h?"Offline"===h?A.emit("RemoteInvitationFailure",e.RtmStatusCode.RemoteInvitationFailureReason.PEER_OFFLINE):"TimeOut"===h&&A.emit("RemoteInvitationFailure",e.RtmStatusCode.RemoteInvitationFailureReason.INVITATION_EXPIRE):A.emit("RemoteInvitationCanceled",v))}else if("AcceptCallAck"===n){var A;T=r.CallId;(A=i._remoteCall[T]).state=e.RtmStatusCode.RemoteInvitationState.ACCEPTED,A.emit("RemoteInvitationAccepted")}else if("AcceptCall"===n){T=r.CallId,C=r.FromUId;r.ToUId;var S=r.Response;(f=i._localCall[T]).state=e.RtmStatusCode.LocalInvitationState.ACCEPTED_BY_REMOTE,f.emit("LocalInvitationAccepted",S)}else if("RejectCall"===n){T=r.CallId,C=r.FromUId;r.ToUId;var p=r.Response;(f=i._localCall[T]).state=e.RtmStatusCode.LocalInvitationState.REFUSED_BY_REMOTE,f.emit("LocalInvitationRefused",p)}else if("CallStatus"===n){T=r.CallId,N=r.Status;var f=i._localCall[T];if(1===N)f.state=e.RtmStatusCode.LocalInvitationState.SENT_TO_REMOTE;else if(2===N)f.state=e.RtmStatusCode.LocalInvitationState.RECEIVED_BY_REMOTE,f.emit("LocalInvitationReceivedByPeer");else if(3===N){f.state=e.RtmStatusCode.LocalInvitationState.FAILURE;var m=e.RtmStatusCode.LocalInvitationFailureReason.PEER_OFFLINE;f.emit("LocalInvitationFailure",m)}else if(4===N){f.state=e.RtmStatusCode.LocalInvitationState.FAILURE;var L=e.RtmStatusCode.LocalInvitationFailureReason.PEER_NO_RESPONSE;f.emit("LocalInvitationFailure",L),f.cancel()}}}},o.prototype._authGateWay=function(n,r){var o=this,a=this;return new Promise((function(_,c){return i(o,void 0,void 0,(function(){var o,u,R,l,d,N,T,O,v,A,p,f,m,L,g=this;return s(this,(function(y){switch(y.label){case 0:return o=new C,this._gateway=o,[4,S(o.joinGateway({appid:a._appId,uid:n,token:r||"",wss:a._useWss},this._joinStartTime))];case 1:return u=E.apply(void 0,[y.sent(),2]),R=u[0],l=u[1],R?(R===I.INVALID_PARAMS?c(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_INVALID_ARGUMENT,"gateway connect failed: ")):R===I.DEVELOPER_INVALID||R===I.UID_BANNED||R===I.IP_BANNED||R===I.CHANNEL_BANNED||R===I.APPID_INVALID||R===I.SERVER_NOT_OPEN?c(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_INVALID_APP_ID)):R===I.TOKEN_EXPIRED?c(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_TOKEN_EXPIRED,"You must request a new token from your server and call join to use the new token to join the channel")):R===I.TOKEN_INVALID?c(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_INVALID_TOKEN,"make sure token is right and try again please")):R===I.TIMEOUT?c(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_TIMEOUT)):c(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_UNKNOWN)),[2]):(a.token=r,d=l.addresses,N=l.sessionid,a._sessionId=N,!d||d instanceof Array&&0===d.length?(c(new h(e.RtmErrorCode.LoginError.LOGIN_ERR_UNKNOWN,"gateway connect failed: Can not find service list")),[2]):[4,S(a._connectRtmServer(l,n,r))]);case 2:return T=E.apply(void 0,[y.sent(),2]),O=T[0],v=T[1],O?(c(O),[2]):v?(A={UserId:n,UserSId:a._sid,AcsToken:r||"",SdkVer:t.VERSION,SessionId:a._sessionId},[4,S(a._rtmServer.doOnline(A))]):(Date.now()-a._joinStartTime<t.GATEWAY_RETRY_TIMEOUT?setTimeout((function(){return i(g,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,this._authGateWay(n,r)];case 1:return e=t.sent(),_(e),[2]}}))}))}),t.GATEWAY_CONNECT_INTERVAL_TIMES):(c(e.RtmStatusCode.ConnectionChangeReason.LOGIN_FAILURE),a._emitConnectionState(e.RtmStatusCode.ConnectionState.DISCONNECTED,e.RtmStatusCode.ConnectionChangeReason.LOGIN_FAILURE)),[2]);case 3:return p=E.apply(void 0,[y.sent(),2]),f=p[0],m=p[1],f?(null===(L=a._rtmServer)||void 0===L||L.disconnectServer(),a._emitConnectionState(e.RtmStatusCode.ConnectionState.DISCONNECTED,e.RtmStatusCode.ConnectionChangeReason.LOGIN_FAILURE),c(f),[2]):(a.uid=m,_(a.uid),[2])}}))}))}))},o.prototype._connectRtmServer=function(e,t,n){var r=this,o=this,_=e.addresses;e.sessionid;var c=_.filter((function(e){return 0===e.type}));return new Promise((function(e,t){return i(r,void 0,void 0,(function(){var t,n,r,i,_,u,R,l,d,N;return s(this,(function(s){switch(s.label){case 0:t=!1,s.label=1;case 1:s.trys.push([1,6,7,8]),n=a(c),r=n.next(),s.label=2;case 2:return r.done?[3,5]:(i=r.value,O.info("begin connect rtm server ",i),null===(d=o._rtmServer)||void 0===d||d.setAppInfo({appId:o._appId}),null===(N=o._rtmServer)||void 0===N||N.configServer(o._useWss,i.addr,i.port),[4,S(o._rtmServer.connectServer())]);case 3:if(_=E.apply(void 0,[s.sent(),1]),!_[0])return t=!0,[3,5];s.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return u=s.sent(),R={error:u},[3,8];case 7:try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(R)throw R.error}return[7];case 8:return e(t),[2]}}))}))}))},o}(te),ae=void 0;e.default=void 0,(ne=e.default||(e.default={})).BUILD="",ne.ConnectionChangeReason=ae,ne.ConnectionState=ae,ne.END_CALL_PREFIX="",ne.LOG_FILTER_ERROR=c.ERROR,ne.LOG_FILTER_INFO=c.INFO,ne.LOG_FILTER_OFF=c.NONE,ne.LOG_FILTER_WARNING=c.WARNING,ne.LocalInvitationState=ae,ne.MessageType=ae,ne.PeerOnlineState=ae,ne.PeerSubscriptionOption=ae,ne.RemoteInvitationFailureReason=ae,ne.LocalInvitationFailureReason=ae,ne.RemoteInvitationState=ae,ne.VERSION=t.VERSION,ne.createInstance=function(t,n){if(!/^[a-zA-Z0-9]{32}$/.test(t))throw new A(e.RtmErrorCode.CreateInstanceError.CREATE_INSTANCE_ERR_INVALID_ARGUMENT,"The appId in the arguments is invalid.");return new se(t,n)},e.ArRTM=e.default,e.LocalInvitation=oe,e.RemoteInvitation=ie,e.RtmChannel=re,e.RtmClient=se,Object.defineProperty(e,"__esModule",{value:!0})}));
